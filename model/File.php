<?php require_once('model/FileError.php'); define("UPLOAD_ERR_EMPTY", 5);define("UPLOAD_ERR_NO_XML", 9);class File{	private $allowedMimeTypes = array('text/xml','application/xml','application/x-xml');	private $errorCode;    private $mimeType;	private $root;	private $recordsCount;	private $recordFields;		public $error;//	private $records;		public function __construct($file)    	{ 		//check file for errors first		if ($file['size'] == 0 ) 		{			$this->errorCode = UPLOAD_ERR_EMPTY;		}		else		{					$this->errorCode = $file['error']; 			$fileExtension = $this->getFileExtension($file['name']);			$this->mimeType = $this->getFileMimeType($file['tmp_name']);						$this->root = simplexml_load_file($file['tmp_name'], 'SimpleXMLElement', LIBXML_NOERROR);				$isFileReadable = ($this->root === false) ? false : true;			if($fileExtension != 'xml' || !in_array($this->mimeType, $this->allowedMimeTypes) || !$isFileReadable) 			{  				$this->errorCode = UPLOAD_ERR_NO_XML;			}							if (!$this->hasError())			{				//read the XML				//in the session was stored $root->asXML();								//read what are the fields of a record				$this->recordFields = array();				$this->recordsCount = $this->root->count();					if($this->recordsCount > 0)				{					$allRecords = $this->root->children();					$firstRecord = $allRecords[0];					foreach($firstRecord->children() as $field)					{						$fieldName = $field->getName();						$this->recordFields[] = $fieldName;					}				}					//save the file otherwise...//				session_start();				$_SESSION['rootRecordAsXML'] = $this->root->asXML();									//check for errors on load					//then, put in the records ?					//then... ? -> count and give the numbers?					//then display the numbers and fields in the view 'showfile'					//on click -> get the selection of fields, 					//			then recount the records					//			then, show the subview 'filter' with the download button?					//			(how to show a subview? with ajax				}		}	}		public function getRecordFields()	{		return $this->recordFields;	}		public function getRecordsCount()	{		return $this->recordsCount;	}			public function hasError()	{		return ($this->errorCode > 0);	}	public function getError()	{		if ($this->hasError()) return new FileError($this->errorCode, $this->mimeType);		else return false;			}		private function getFileExtension($name)	{ 		$extension = end(explode('.', $name));		$extensionLowerCase = strtolower($extension);		return $extensionLowerCase;	}    	private function getFileMimeType($temp_name)	{        $finfo = finfo_open(FILEINFO_MIME_TYPE);        $mimeType = finfo_file($finfo, $temp_name);        finfo_close($finfo);				return $mimeType;	}}?>